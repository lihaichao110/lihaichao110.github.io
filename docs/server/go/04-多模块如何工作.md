# Go 多模块工作空间 (Workspaces)

## 什么是工作空间？

Go 工作空间是 Go 1.18 引入的新特性，它让你可以在一个项目中同时开发多个模块，而不需要修改每个模块的 `go.mod` 文件。

**简单理解：** 就像一个大办公室里有多个小房间，每个房间都是独立的模块，但它们可以互相协作。

## 为什么需要工作空间？

在没有工作空间之前，如果你要同时修改两个相关的模块，你需要：
- 使用 `replace` 指令修改 `go.mod` 文件
- 或者发布新版本后再更新依赖

现在有了工作空间，你可以：
- ✅ 同时开发多个模块
- ✅ 实时看到模块间的变化
- ✅ 不需要修改 `go.mod` 文件

## 快速上手示例

### 第一步：创建项目结构

```bash
# 创建工作空间目录
mkdir workspace
cd workspace

# 创建第一个模块
mkdir hello
cd hello
go mod init example.com/hello
```

### 第二步：编写代码

创建 `hello/hello.go`：

```go
package main

import (
    "fmt"
    "golang.org/x/example/hello/reverse"
)

func main() {
    fmt.Println(reverse.String("Hello"))
}
```

添加依赖：

```bash
go get golang.org/x/example/hello/reverse
```

运行测试：

```bash
go run .
# 输出：olleH
```

### 第三步：创建工作空间

回到 `workspace` 目录：

```bash
cd ..
go work init ./hello
```

这会创建一个 `go.work` 文件：

```go
go 1.18

use ./hello
```

### 第四步：添加第二个模块

下载示例模块并添加到工作空间：

```bash
git clone https://go.googlesource.com/example
go work use ./example/hello
```

现在 `go.work` 文件变成：

```go
go 1.18

use (
    ./hello
    ./example/hello
)
```

### 第五步：修改依赖模块

修改 `example/hello/reverse/reverse.go`：

```go
package reverse

import "strconv"

// String 反转字符串
func String(s string) string {
    // 你的自定义逻辑
    return "自定义: " + reverseString(s)
}

func reverseString(s string) string {
    runes := []rune(s)
    for i, j := 0, len(runes)-1; i < j; i, j = i+1, j-1 {
        runes[i], runes[j] = runes[j], runes[i]
    }
    return string(runes)
}
```

### 第六步：测试效果

```bash
go run ./hello
# 输出：自定义: olleH
```

## 工作空间的核心概念

### 1. `go.work` 文件

这是工作空间的配置文件，类似于 `go.mod`：

```go
go 1.18          // Go 版本

use (             // 使用的模块列表
    ./module1
    ./module2
    ./module3
)
```

### 2. `use` 指令

告诉 Go 哪些目录包含要在工作空间中使用的模块。

### 3. 主模块

工作空间中的所有模块都被视为主模块，这意味着它们可以相互引用。

## 常用命令

### 初始化工作空间
```bash
go work init [模块路径...]
```

### 添加模块到工作空间
```bash
go work use [模块路径]
```

### 编辑工作空间文件
```bash
go work edit
```

### 同步依赖
```bash
go work sync
```

## 实际应用场景

### 场景1：微服务开发
```
project/
├── go.work
├── user-service/
│   └── go.mod
├── order-service/
│   └── go.mod
└── common/
    └── go.mod
```

### 场景2：库和应用同时开发
```
workspace/
├── go.work
├── myapp/          # 你的应用
│   └── go.mod
└── mylib/          # 你开发的库
    └── go.mod
```

## 最佳实践

### ✅ 推荐做法

1. **项目结构清晰**：每个模块都有自己的目录
2. **版本管理**：正式发布前记得更新版本号
3. **依赖管理**：定期运行 `go work sync`

### ❌ 避免的问题

1. **不要提交 `go.work`**：这通常是开发时的临时文件
2. **不要嵌套工作空间**：一个工作空间就够了
3. **注意路径**：确保模块路径正确

## 小白总结

**工作空间就像一个项目管理器：**

1. 🏠 **一个大房子**（工作空间）
2. 🏠 **多个房间**（不同的模块）
3. 🚪 **房间可以互通**（模块可以相互引用）
4. 📋 **有个管理清单**（`go.work` 文件）

**什么时候用工作空间？**
- 同时开发多个相关的 Go 模块
- 需要实时测试模块间的交互
- 不想频繁修改 `go.mod` 文件

**记住这个流程：**
1. `go work init` - 创建工作空间
2. `go work use` - 添加模块
3. 正常开发和测试
4. 发布时更新各模块版本

## 参考资料

- [Go 官方工作空间教程](https://go.dev/doc/tutorial/workspaces)
- [Go 模块参考文档](https://go.dev/ref/mod#workspaces) 