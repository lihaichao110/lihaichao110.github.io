# Go å¤šæ¨¡å—å·¥ä½œç©ºé—´ (Workspaces)

## ä»€ä¹ˆæ˜¯å·¥ä½œç©ºé—´ï¼Ÿ

Go å·¥ä½œç©ºé—´æ˜¯ Go 1.18 å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œå®ƒè®©ä½ å¯ä»¥åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­åŒæ—¶å¼€å‘å¤šä¸ªæ¨¡å—ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æ¯ä¸ªæ¨¡å—çš„ `go.mod` æ–‡ä»¶ã€‚

**ç®€å•ç†è§£ï¼š** å°±åƒä¸€ä¸ªå¤§åŠå…¬å®¤é‡Œæœ‰å¤šä¸ªå°æˆ¿é—´ï¼Œæ¯ä¸ªæˆ¿é—´éƒ½æ˜¯ç‹¬ç«‹çš„æ¨¡å—ï¼Œä½†å®ƒä»¬å¯ä»¥äº’ç›¸åä½œã€‚

## ä¸ºä»€ä¹ˆéœ€è¦å·¥ä½œç©ºé—´ï¼Ÿ

åœ¨æ²¡æœ‰å·¥ä½œç©ºé—´ä¹‹å‰ï¼Œå¦‚æœä½ è¦åŒæ—¶ä¿®æ”¹ä¸¤ä¸ªç›¸å…³çš„æ¨¡å—ï¼Œä½ éœ€è¦ï¼š
- ä½¿ç”¨ `replace` æŒ‡ä»¤ä¿®æ”¹ `go.mod` æ–‡ä»¶
- æˆ–è€…å‘å¸ƒæ–°ç‰ˆæœ¬åå†æ›´æ–°ä¾èµ–

ç°åœ¨æœ‰äº†å·¥ä½œç©ºé—´ï¼Œä½ å¯ä»¥ï¼š
- âœ… åŒæ—¶å¼€å‘å¤šä¸ªæ¨¡å—
- âœ… å®æ—¶çœ‹åˆ°æ¨¡å—é—´çš„å˜åŒ–
- âœ… ä¸éœ€è¦ä¿®æ”¹ `go.mod` æ–‡ä»¶

## å¿«é€Ÿä¸Šæ‰‹ç¤ºä¾‹

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡¹ç›®ç»“æ„

```bash
# åˆ›å»ºå·¥ä½œç©ºé—´ç›®å½•
mkdir workspace
cd workspace

# åˆ›å»ºç¬¬ä¸€ä¸ªæ¨¡å—
mkdir hello
cd hello
go mod init example.com/hello
```

### ç¬¬äºŒæ­¥ï¼šç¼–å†™ä»£ç 

åˆ›å»º `hello/hello.go`ï¼š

```go
package main

import (
    "fmt"
    "golang.org/x/example/hello/reverse"
)

func main() {
    fmt.Println(reverse.String("Hello"))
}
```

æ·»åŠ ä¾èµ–ï¼š

```bash
go get golang.org/x/example/hello/reverse
```

è¿è¡Œæµ‹è¯•ï¼š

```bash
go run .
# è¾“å‡ºï¼šolleH
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå·¥ä½œç©ºé—´

å›åˆ° `workspace` ç›®å½•ï¼š

```bash
cd ..
go work init ./hello
```

è¿™ä¼šåˆ›å»ºä¸€ä¸ª `go.work` æ–‡ä»¶ï¼š

```go
go 1.18

use ./hello
```

### ç¬¬å››æ­¥ï¼šæ·»åŠ ç¬¬äºŒä¸ªæ¨¡å—

ä¸‹è½½ç¤ºä¾‹æ¨¡å—å¹¶æ·»åŠ åˆ°å·¥ä½œç©ºé—´ï¼š

```bash
git clone https://go.googlesource.com/example
go work use ./example/hello
```

ç°åœ¨ `go.work` æ–‡ä»¶å˜æˆï¼š

```go
go 1.18

use (
    ./hello
    ./example/hello
)
```

### ç¬¬äº”æ­¥ï¼šä¿®æ”¹ä¾èµ–æ¨¡å—

ä¿®æ”¹ `example/hello/reverse/reverse.go`ï¼š

```go
package reverse

import "strconv"

// String åè½¬å­—ç¬¦ä¸²
func String(s string) string {
    // ä½ çš„è‡ªå®šä¹‰é€»è¾‘
    return "è‡ªå®šä¹‰: " + reverseString(s)
}

func reverseString(s string) string {
    runes := []rune(s)
    for i, j := 0, len(runes)-1; i < j; i, j = i+1, j-1 {
        runes[i], runes[j] = runes[j], runes[i]
    }
    return string(runes)
}
```

### ç¬¬å…­æ­¥ï¼šæµ‹è¯•æ•ˆæœ

```bash
go run ./hello
# è¾“å‡ºï¼šè‡ªå®šä¹‰: olleH
```

## å·¥ä½œç©ºé—´çš„æ ¸å¿ƒæ¦‚å¿µ

### 1. `go.work` æ–‡ä»¶

è¿™æ˜¯å·¥ä½œç©ºé—´çš„é…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼äº `go.mod`ï¼š

```go
go 1.18          // Go ç‰ˆæœ¬

use (             // ä½¿ç”¨çš„æ¨¡å—åˆ—è¡¨
    ./module1
    ./module2
    ./module3
)
```

### 2. `use` æŒ‡ä»¤

å‘Šè¯‰ Go å“ªäº›ç›®å½•åŒ…å«è¦åœ¨å·¥ä½œç©ºé—´ä¸­ä½¿ç”¨çš„æ¨¡å—ã€‚

### 3. ä¸»æ¨¡å—

å·¥ä½œç©ºé—´ä¸­çš„æ‰€æœ‰æ¨¡å—éƒ½è¢«è§†ä¸ºä¸»æ¨¡å—ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥ç›¸äº’å¼•ç”¨ã€‚

## å¸¸ç”¨å‘½ä»¤

### åˆå§‹åŒ–å·¥ä½œç©ºé—´
```bash
go work init [æ¨¡å—è·¯å¾„...]
```

### æ·»åŠ æ¨¡å—åˆ°å·¥ä½œç©ºé—´
```bash
go work use [æ¨¡å—è·¯å¾„]
```

### ç¼–è¾‘å·¥ä½œç©ºé—´æ–‡ä»¶
```bash
go work edit
```

### åŒæ­¥ä¾èµ–
```bash
go work sync
```

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå¾®æœåŠ¡å¼€å‘
```
project/
â”œâ”€â”€ go.work
â”œâ”€â”€ user-service/
â”‚   â””â”€â”€ go.mod
â”œâ”€â”€ order-service/
â”‚   â””â”€â”€ go.mod
â””â”€â”€ common/
    â””â”€â”€ go.mod
```

### åœºæ™¯2ï¼šåº“å’Œåº”ç”¨åŒæ—¶å¼€å‘
```
workspace/
â”œâ”€â”€ go.work
â”œâ”€â”€ myapp/          # ä½ çš„åº”ç”¨
â”‚   â””â”€â”€ go.mod
â””â”€â”€ mylib/          # ä½ å¼€å‘çš„åº“
    â””â”€â”€ go.mod
```

## æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **é¡¹ç›®ç»“æ„æ¸…æ™°**ï¼šæ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ç›®å½•
2. **ç‰ˆæœ¬ç®¡ç†**ï¼šæ­£å¼å‘å¸ƒå‰è®°å¾—æ›´æ–°ç‰ˆæœ¬å·
3. **ä¾èµ–ç®¡ç†**ï¼šå®šæœŸè¿è¡Œ `go work sync`

### âŒ é¿å…çš„é—®é¢˜

1. **ä¸è¦æäº¤ `go.work`**ï¼šè¿™é€šå¸¸æ˜¯å¼€å‘æ—¶çš„ä¸´æ—¶æ–‡ä»¶
2. **ä¸è¦åµŒå¥—å·¥ä½œç©ºé—´**ï¼šä¸€ä¸ªå·¥ä½œç©ºé—´å°±å¤Ÿäº†
3. **æ³¨æ„è·¯å¾„**ï¼šç¡®ä¿æ¨¡å—è·¯å¾„æ­£ç¡®

## å°ç™½æ€»ç»“

**å·¥ä½œç©ºé—´å°±åƒä¸€ä¸ªé¡¹ç›®ç®¡ç†å™¨ï¼š**

1. ğŸ  **ä¸€ä¸ªå¤§æˆ¿å­**ï¼ˆå·¥ä½œç©ºé—´ï¼‰
2. ğŸ  **å¤šä¸ªæˆ¿é—´**ï¼ˆä¸åŒçš„æ¨¡å—ï¼‰
3. ğŸšª **æˆ¿é—´å¯ä»¥äº’é€š**ï¼ˆæ¨¡å—å¯ä»¥ç›¸äº’å¼•ç”¨ï¼‰
4. ğŸ“‹ **æœ‰ä¸ªç®¡ç†æ¸…å•**ï¼ˆ`go.work` æ–‡ä»¶ï¼‰

**ä»€ä¹ˆæ—¶å€™ç”¨å·¥ä½œç©ºé—´ï¼Ÿ**
- åŒæ—¶å¼€å‘å¤šä¸ªç›¸å…³çš„ Go æ¨¡å—
- éœ€è¦å®æ—¶æµ‹è¯•æ¨¡å—é—´çš„äº¤äº’
- ä¸æƒ³é¢‘ç¹ä¿®æ”¹ `go.mod` æ–‡ä»¶

**è®°ä½è¿™ä¸ªæµç¨‹ï¼š**
1. `go work init` - åˆ›å»ºå·¥ä½œç©ºé—´
2. `go work use` - æ·»åŠ æ¨¡å—
3. æ­£å¸¸å¼€å‘å’Œæµ‹è¯•
4. å‘å¸ƒæ—¶æ›´æ–°å„æ¨¡å—ç‰ˆæœ¬

## å‚è€ƒèµ„æ–™

- [Go å®˜æ–¹å·¥ä½œç©ºé—´æ•™ç¨‹](https://go.dev/doc/tutorial/workspaces)
- [Go æ¨¡å—å‚è€ƒæ–‡æ¡£](https://go.dev/ref/mod#workspaces) 